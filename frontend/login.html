<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>JaagrukVoter - Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
      body { font-family: 'Inter', sans-serif; }
      /* Loader for button states */
      .loader {
          border: 2px solid #f3f3f3;
          border-top: 2px solid #3498db;
          border-radius: 50%;
          width: 16px;
          height: 16px;
          animation: spin 1s linear infinite;
          display: inline-block;
      }
      @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
  </style>
</head>
<body class="min-h-screen flex items-center justify-center bg-sky-50 px-4">
  <div class="bg-white shadow-xl rounded-2xl p-8 w-full max-w-md transition-all hover:shadow-2xl">
    <div class="text-center mb-8">
        <h1 class="text-3xl font-extrabold text-sky-700 tracking-tight">JaagrukVoter</h1>
        <p class="text-gray-500 mt-2">Sign in to access personalized election data</p>
    </div>

    <!-- Login Form -->
    <form id="loginForm" onsubmit="event.preventDefault();">
        <label class="block mb-2 text-sm font-semibold text-gray-700" for="email">
          Email Address
        </label>
        <input
          id="email"
          type="email"
          required
          class="w-full px-4 py-3 mb-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-sky-500 focus:border-transparent transition-all"
          placeholder="name@example.com"
        />

        <button
          id="loginBtn"
          type="submit"
          class="w-full bg-sky-600 hover:bg-sky-700 text-white py-3 rounded-lg font-bold transition-colors flex items-center justify-center gap-2 shadow-lg shadow-sky-200"
        >
          <span>Login with Email</span>
        </button>
    </form>

    <div class="flex items-center my-6">
      <div class="flex-1 border-t border-gray-200"></div>
      <span class="px-3 text-xs font-medium text-gray-400 uppercase">Or</span>
      <div class="flex-1 border-t border-gray-200"></div>
    </div>

    <button
      id="guestBtn"
      class="w-full bg-gray-800 hover:bg-gray-900 text-white py-3 rounded-lg font-bold transition-colors flex items-center justify-center gap-2 shadow-lg shadow-gray-200"
    >
      <span>Continue as Guest</span>
    </button>

    <!-- Error Message Container -->
    <div id="error" class="mt-4 p-3 bg-red-50 border-l-4 border-red-500 text-red-700 text-sm rounded hidden opacity-0 transition-opacity duration-300"></div>

    <p class="text-xs text-gray-400 mt-6 text-center">
      Administrator? <a href="admin-login.html" class="text-sky-600 hover:text-sky-800 hover:underline font-medium">Access Admin Panel</a>
    </p>
  </div>

<script>
  const API_BASE = "https://jaagrukvoter-backend-2.onrender.com";
  
  // DOM Elements
  const DOM = {
      email: document.getElementById("email"),
      loginBtn: document.getElementById("loginBtn"),
      guestBtn: document.getElementById("guestBtn"),
      error: document.getElementById("error")
  };

  // UI Helper Functions
  const UI = {
      setLoading: (btn, isLoading) => {
          if (isLoading) {
              const originalText = btn.querySelector('span').innerText;
              btn.dataset.originalText = originalText;
              btn.innerHTML = `<div class="loader"></div> Processing...`;
              btn.disabled = true;
              btn.classList.add('opacity-75', 'cursor-not-allowed');
          } else {
              btn.innerHTML = `<span>${btn.dataset.originalText || 'Submit'}</span>`;
              btn.disabled = false;
              btn.classList.remove('opacity-75', 'cursor-not-allowed');
          }
      },
      showError: (msg) => {
          DOM.error.textContent = msg;
          DOM.error.classList.remove("hidden");
          setTimeout(() => DOM.error.classList.remove("opacity-0"), 10);
      },
      hideError: () => {
          DOM.error.classList.add("hidden", "opacity-0");
      }
  };

  // ðŸ”¹ NORMAL LOGIN LOGIC
  DOM.loginBtn.addEventListener("click", async (e) => {
    e.preventDefault(); 
    UI.hideError();
    
    const email = DOM.email.value.trim();
    
    if (!email) {
      UI.showError("Please enter a valid email address.");
      return;
    }

    UI.setLoading(DOM.loginBtn, true);

    try {
      const res = await fetch(`${API_BASE}/api/login`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ email })
      });

      const data = await res.json();
      if (!res.ok) throw new Error(data.error || "Login failed");

      // Success
      localStorage.setItem("user_logged_in", "yes");
      // CORRECTED REDIRECT: Points to index.html (the main app)
      window.location.href = "index.html"; 

    } catch (err) {
      UI.showError(err.message);
      UI.setLoading(DOM.loginBtn, false);
    }
  });

  // ðŸ”¹ GUEST LOGIN LOGIC
  DOM.guestBtn.addEventListener("click", async () => {
    UI.hideError();
    UI.setLoading(DOM.guestBtn, true);
    
    try {
      const res = await fetch(`${API_BASE}/api/login-guest`, { method: "POST" });
      const data = await res.json();

      if (!res.ok) throw new Error(data.error || "Guest login failed");

      // Success
      localStorage.setItem("user_logged_in", "guest");
      // CORRECTED REDIRECT: Points to index.html (the main app)
      window.location.href = "index.html"; 

    } catch (err) {
      UI.showError(err.message);
      UI.setLoading(DOM.guestBtn, false);
    }
  });
</script>
</body>
</html>